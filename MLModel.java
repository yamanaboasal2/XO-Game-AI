import java.util.Arrays;

public class MLModel {

    private static final int INPUT = 6;
    private static final int H1 = 18;
    private static final int H2 = 8;
    private static final int OUTPUT = 2;
    private static final double LEAKY = 0.01;


    private static final double[][] W1 = {
            { -0.468022, -2.123282,  2.376196, -4.121613,  1.002368,  1.390930 },
            { -0.445433, -0.628382,  0.573391, -2.015077,  1.102637, -2.078435 },
            {  3.495707, -1.702932, -0.046502, -1.438335, -0.757662, -0.159823 },
            { -3.186374,  2.561727,  2.917473,  0.272393, -0.572315, -0.940523 },
            { -1.576423, -0.426458,  1.429141, -1.734339,  0.599652, -0.056423 },
            { -0.393088, -0.605993,  0.807354, -0.052723,  0.000117, -0.123452 },
            { -1.046660, -0.140307, -0.178997,  1.513658,  0.024349,  2.346185 },
            {  0.538992,  0.197838, -2.582419, -2.283405, -1.074120,  0.564041 },
            {  4.771920, -2.428437, -0.997786,  0.367391, -0.515346, -1.137615 },
            {  0.589296, -5.259653,  2.012317,  4.730074,  1.001415,  1.326405 },
            {  2.567580, -0.002089, -1.781901, -0.585712, -1.666137, -3.442278 },
            {  0.459464,  0.434108,  0.977654, -1.594847,  0.208480, -3.562464 },
            { -0.977833, -0.973208, -0.172357,  0.870525,  0.718161, -1.035514 },
            { -1.270753,  0.625156,  1.290409, -0.619025, -0.766416,  0.074179 },
            { -0.470939,  0.794568,  1.881823, -1.031316, -1.085465, -0.450570 },
            {  0.497083, -0.812117, -1.626761,  2.554498, -1.037101, -1.666397 },
            { -0.748822, -0.806015, -0.414337,  0.065026, -0.273185,  0.737856 },
            {  6.235024, -4.546645, -1.182442, -2.424118,  1.103221, -0.399533 }
    };

    private static final double[][] W2 = {
            {  0.250454, -0.931815, -0.297120, -0.339817, -0.132430,  0.296010,  0.053194, -0.969807,  1.181875, -0.504499, -0.837930, -0.106535, -0.247781, -0.528805, -0.419231,  0.395782,  0.285177, -0.144424 },
            {  1.212470, -0.651213, -0.202951,  0.377850,  0.454949,  0.357869,  0.332811, -0.158492,  0.270782, -0.502948, -0.094701,  0.517673, -1.321332, -0.226566,  0.246390, -0.651729,  0.442766, -0.796774 },
            {  0.377420, -0.498131,  0.330018, -0.557066, -0.565920,  0.052360,  0.071045, -0.698243,  0.360894, -0.658691, -0.854670, -0.425656, -0.465441, -0.769464, -0.558202, -0.752495,  0.315899, -0.282728 },
            { -0.419209, -0.037995,  0.368228, -0.769944,  0.160346,  0.298665, -1.413373,  0.516004,  1.676642,  0.668248,  0.815935, -2.430736, -0.197881, -0.356349, -0.190286,  1.100731,  0.061455, -3.563203 },
            { -2.106601,  1.190642, -0.462043, -0.786735, -0.848194,  0.571754,  0.864465, -0.226839, -0.472036,  1.458821, -0.915408,  1.370403, -1.024198, -1.227693, -1.141724,  0.275534, -1.181646, -0.010770 },
            {  0.040215, -0.295975,  0.408098, -1.652216, -0.099451,  0.120109,  0.049696, -0.575258,  0.319620,  0.329435, -0.879602, -0.506542, -0.193555, -0.177250, -0.533167, -0.971313, -0.253777,  0.828838 },
            {  0.424855, -1.134588,  1.430183, -0.817086, -0.583936, -0.030883, -0.891629, -1.309946,  0.359523, -1.422459, -1.460493, -0.983351, -0.182588, -0.039077,  0.161862, -1.398421, -0.076300,  0.995443 },
            {  0.285813,  0.120220, -2.025149,  0.399655,  1.080198,  0.691434, -0.163373,  1.946231, -1.650835, -0.054870,  1.398234,  0.275743, -0.459414, -0.349632,  0.403099, -1.583494, -0.247965, -2.138987 }
    };

    private static final double[][] W3 = {
            {  0.548537,  0.437324,  1.061541, -0.565552, -0.562554,  0.731816,  0.923803,  0.340491 },
            { -0.295973, -0.339760, -0.258338,  0.990353,  0.725321, -0.102599, -0.261802, -0.705486 }
    };
    private static double lrelu(double x) {
        return x > 0 ? x : LEAKY * x;
    }

    private static double[] softmax(double[] z) {
        double max = Arrays.stream(z).max().getAsDouble();
        double sum = 0;
        double[] o = new double[z.length];
        for (int i = 0; i < z.length; i++) {
            o[i] = Math.exp(z[i] - max);
            sum += o[i];
        }
        for (int i = 0; i < z.length; i++)
            o[i] /= sum;
        return o;
    }

    public static double predictScore(double[] x) {

        double[] h1 = new double[H1];
        for (int i = 0; i < H1; i++) {
            double s = 0;
            for (int j = 0; j < INPUT; j++)
                s += W1[i][j] * x[j];
            h1[i] = lrelu(s);
        }

        double[] h2 = new double[H2];
        for (int i = 0; i < H2; i++) {
            double s = 0;
            for (int j = 0; j < H1; j++)
                s += W2[i][j] * h1[j];
            h2[i] = lrelu(s);
        }

        double[] out = new double[OUTPUT];
        for (int k = 0; k < OUTPUT; k++) {
            double s = 0;
            for (int j = 0; j < H2; j++)
                s += W3[k][j] * h2[j];
            out[k] = s;
        }

        double[] p = softmax(out);


        return p[0] - p[1];
    }

}
